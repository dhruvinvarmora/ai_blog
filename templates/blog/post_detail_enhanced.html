{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} - Plant Blog{% endblock %}

{% block meta_description %}{{ post.summary }}{% endblock %}

{% block content %}
<!-- Post Header with Hero Image -->
<section class="post-header" style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('{{ post.featured_image_url|default:post.thumbnail_url|default:"https://images.unsplash.com/photo-1466781783364-36c955e42a7f?w=1200&h=600&fit=crop" }}') center/cover; min-height: 500px; display: flex; align-items: center; color: white;">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <div class="category-badge mb-3">
                    <span class="badge badge-{{ post.category }}">{{ post.get_category_display }}</span>
                </div>
                <h1 class="display-4 font-weight-bold mb-4">{{ post.title }}</h1>
                <p class="lead mb-4">{{ post.summary }}</p>
                <div class="post-meta">
                    <span><i class="fa fa-calendar"></i> {{ post.published_at|date:"F j, Y" }}</span>
                    <span class="ml-3"><i class="fa fa-eye"></i> {{ post.view_count }} views</span>
                    {% if post.scientific_name %}
                    <span class="ml-3"><i class="fa fa-leaf"></i> {{ post.scientific_name }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Plant Information Card -->
{% if post.scientific_name or post.care_difficulty or post.watering_needs %}
<section class="plant-info py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h3 class="mb-0"><i class="fa fa-info-circle"></i> Plant Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% if post.scientific_name %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-leaf"></i> Scientific Name:</strong>
                                <p class="text-muted">{{ post.scientific_name }}</p>
                            </div>
                            {% endif %}
                            {% if post.family %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-sitemap"></i> Family:</strong>
                                <p class="text-muted">{{ post.family }}</p>
                            </div>
                            {% endif %}
                            {% if post.care_difficulty %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-star"></i> Care Difficulty:</strong>
                                <p class="text-muted">
                                    {% if post.care_difficulty == 'easy' %}
                                        <span class="badge badge-success">Easy</span>
                                    {% elif post.care_difficulty == 'medium' %}
                                        <span class="badge badge-warning">Medium</span>
                                    {% elif post.care_difficulty == 'hard' %}
                                        <span class="badge badge-danger">Hard</span>
                                    {% endif %}
                                </p>
                            </div>
                            {% endif %}
                            {% if post.watering_needs %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-tint"></i> Watering Needs:</strong>
                                <p class="text-muted">{{ post.watering_needs }}</p>
                            </div>
                            {% endif %}
                            {% if post.sunlight_requirements %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-sun-o"></i> Sunlight Requirements:</strong>
                                <p class="text-muted">{{ post.sunlight_requirements }}</p>
                            </div>
                            {% endif %}
                            {% if post.growth_rate %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-line-chart"></i> Growth Rate:</strong>
                                <p class="text-muted">{{ post.growth_rate }}</p>
                            </div>
                            {% endif %}
                            {% if post.max_height %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-arrows-v"></i> Max Height:</strong>
                                <p class="text-muted">{{ post.max_height }}</p>
                            </div>
                            {% endif %}
                            {% if post.blooming_season %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-calendar-o"></i> Blooming Season:</strong>
                                <p class="text-muted">{{ post.blooming_season }}</p>
                            </div>
                            {% endif %}
                            {% if post.harvest_time %}
                            <div class="col-md-6 mb-3">
                                <strong><i class="fa fa-clock-o"></i> Harvest Time:</strong>
                                <p class="text-muted">{{ post.harvest_time }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Image Gallery Section -->
{% if post.main_images %}
<section class="image-gallery py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h3 class="text-center mb-5"><i class="fa fa-camera"></i> Visual Guide</h3>
                <div class="row">
                    {% for image in post.main_images %}
                    <div class="col-md-6 mb-4">
                        <div class="image-card shadow-sm">
                            <img src="{{ image.image_url }}" class="img-fluid rounded" alt="{{ image.alt_text }}" data-toggle="lightbox" data-gallery="plant-gallery">
                            {% if image.caption %}
                            <div class="image-caption p-3">
                                <p class="mb-0 text-muted"><i class="fa fa-info-circle"></i> {{ image.caption }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% else %}
<!-- Sample Image Gallery (when no images are available) -->
<section class="image-gallery py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h3 class="text-center mb-5"><i class="fa fa-camera"></i> Visual Guide</h3>
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="image-card shadow-sm">
                            <img src="https://images.unsplash.com/photo-1466781783364-36c955e42a7f?w=600&h=400&fit=crop" class="img-fluid rounded" alt="Plant care guide" data-toggle="lightbox" data-gallery="plant-gallery">
                            <div class="image-caption p-3">
                                <p class="mb-0 text-muted"><i class="fa fa-info-circle"></i> Beautiful {{ post.get_category_display|lower }} in natural setting</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="image-card shadow-sm">
                            <img src="https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=600&h=400&fit=crop" class="img-fluid rounded" alt="Plant care tips" data-toggle="lightbox" data-gallery="plant-gallery">
                            <div class="image-caption p-3">
                                <p class="mb-0 text-muted"><i class="fa fa-info-circle"></i> Care and maintenance tips for {{ post.get_category_display|lower }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="image-card shadow-sm">
                            <img src="https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=600&h=400&fit=crop" class="img-fluid rounded" alt="Close up view" data-toggle="lightbox" data-gallery="plant-gallery">
                            <div class="image-caption p-3">
                                <p class="mb-0 text-muted"><i class="fa fa-info-circle"></i> Close up view of healthy {{ post.get_category_display|lower }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="image-card shadow-sm">
                            <img src="https://images.unsplash.com/photo-1585320806297-9794b3e4eeae?w=600&h=400&fit=crop" class="img-fluid rounded" alt="Indoor plant care" data-toggle="lightbox" data-gallery="plant-gallery">
                            <div class="image-caption p-3">
                                <p class="mb-0 text-muted"><i class="fa fa-info-circle"></i> Indoor {{ post.get_category_display|lower }} care guide</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Post Content -->
<section class="post-content py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="content-wrapper">
                    {{ post.content|safe }}
                </div>
                
                <!-- Tags -->
                {% if post.tags.all %}
                <div class="tags-section mt-4">
                    <h5><i class="fa fa-tags"></i> Tags:</h5>
                    {% for tag in post.tags.all %}
                    <a href="{% url 'blog:tag_posts' tag.slug %}" class="badge badge-secondary mr-2">{{ tag.name }}</a>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Video Section -->
                {% if post.video_url %}
                <div class="video-section mt-5">
                    <h4><i class="fa fa-play-circle"></i> Related Video</h4>
                    <div class="embed-responsive embed-responsive-16by9">
                        <iframe class="embed-responsive-item" src="{{ post.video_url }}" allowfullscreen></iframe>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Additional Images Grid -->
{% if post.main_images.count > 4 %}
<section class="additional-images py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h3 class="text-center mb-5"><i class="fa fa-images"></i> More Photos</h3>
                <div class="row">
                    {% for image in post.main_images|slice:"4:" %}
                    <div class="col-md-4 mb-4">
                        <div class="image-card shadow-sm">
                            <img src="{{ image.image_url }}" class="img-fluid rounded" alt="{{ image.alt_text }}" data-toggle="lightbox" data-gallery="plant-gallery">
                            {% if image.caption %}
                            <div class="image-caption p-2">
                                <p class="mb-0 text-muted small">{{ image.caption }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Related Posts -->
{% if related_posts %}
<section class="related-posts py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h3 class="mb-4"><i class="fa fa-link"></i> Related Posts</h3>
                <div class="row">
                    {% for related_post in related_posts %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            {% if related_post.thumbnail_url %}
                            <img src="{{ related_post.thumbnail_url }}" class="card-img-top" alt="{{ related_post.title }}">
                            {% endif %}
                            <div class="card-body">
                                <h6 class="card-title">{{ related_post.title }}</h6>
                                <p class="card-text text-muted">{{ related_post.summary|truncatewords:20 }}</p>
                                <a href="{% url 'blog:post_detail' related_post.slug %}" class="btn btn-outline-primary btn-sm">Read More</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Category Navigation -->
<section class="category-nav py-3">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="d-flex justify-content-between">
                    <a href="{% url 'blog:category_posts' post.category %}" class="btn btn-outline-success">
                        <i class="fa fa-arrow-left"></i> More {{ post.get_category_display }}
                    </a>
                    <a href="{% url 'blog:blog' %}" class="btn btn-outline-primary">
                        <i class="fa fa-list"></i> All Posts
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.category-badge .badge {
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
}

.post-meta span {
    font-size: 0.9rem;
    opacity: 0.9;
}

.plant-info .card {
    border: none;
    border-radius: 15px;
}

.plant-info .card-header {
    border-radius: 15px 15px 0 0 !important;
}

.content-wrapper {
    font-size: 1.1rem;
    line-height: 1.8;
}

.content-wrapper h2, .content-wrapper h3 {
    color: #28a745;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

.tags-section .badge {
    font-size: 0.8rem;
    padding: 0.4rem 0.8rem;
}

.video-section {
    border-top: 2px solid #e9ecef;
    padding-top: 2rem;
}

.related-posts .card {
    transition: transform 0.2s;
}

.related-posts .card:hover {
    transform: translateY(-5px);
}

/* Image Gallery Styles */
.image-card {
    border-radius: 10px;
    overflow: hidden;
    transition: transform 0.3s ease;
    background: white;
}

.image-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
}

.image-card img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.image-card:hover img {
    transform: scale(1.05);
}

.image-caption {
    background: rgba(255, 255, 255, 0.95);
    border-top: 1px solid #e9ecef;
}

.image-gallery h3 {
    color: #28a745;
    font-weight: 600;
}

.additional-images h3 {
    color: #6c757d;
    font-weight: 600;
}

/* Lightbox Gallery */
[data-toggle="lightbox"] {
    cursor: pointer;
}

[data-toggle="lightbox"]:hover {
    opacity: 0.8;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .image-card img {
        height: 200px;
    }
    
    .post-header {
        min-height: 400px;
    }
    
    .display-4 {
        font-size: 2rem;
    }
}

/* Enhanced visual effects */
.image-gallery {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.image-card {
    border: 1px solid rgba(0,0,0,0.1);
}

.image-caption {
    font-size: 0.9rem;
    font-weight: 500;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Initialize lightbox for image gallery
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
        event.preventDefault();
        $(this).ekkoLightbox({
            galleryParentSelector: 'body'
        });
    });
    
    // Add smooth scrolling for better UX
    $('a[href^="#"]').on('click', function(event) {
        var target = $(this.getAttribute('href'));
        if( target.length ) {
            event.preventDefault();
            $('html, body').stop().animate({
                scrollTop: target.offset().top - 100
            }, 1000);
        }
    });
});
</script>
{% endblock %} 